jQuery(function(t){if("undefined"==typeof kco_params)return!1;var a={bodyEl:t("body"),checkoutFormSelector:"form.checkout",orderNotesValue:"",orderNotesSelector:"textarea#order_comments",orderNotesEl:t("textarea#order_comments"),extraFieldsValues:{},extraFieldsSelectorText:'div#kco-extra-fields input[type="text"], div#kco-extra-fields input[type="password"], div#kco-extra-fields textarea',extraFieldsSelectorNonText:'div#kco-extra-fields select, div#kco-extra-fields input[type="radio"], div#kco-extra-fields input[type="checkbox"], div#kco-extra-fields input.checkout-date-picker',paymentMethodEl:t('input[name="payment_method"]'),paymentMethod:"",selectAnotherSelector:"#klarna-checkout-select-other",documentReady:function(){a.log(kco_params),0<a.paymentMethodEl.length?a.paymentMethod=a.paymentMethodEl.filter(":checked").val():a.paymentMethod="kco",a.confirmLoading()},kcoSuspend:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.suspend()})},kcoResume:function(){window._klarnaCheckout&&window._klarnaCheckout(function(e){e.resume()})},confirmLoading:function(){t("#kco-confirm-loading").css("minHeight","300px").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},updateCart:function(){a.kcoSuspend(),t.ajax({type:"POST",url:kco_params.update_cart_url,data:{checkout:t("form.checkout").serialize(),nonce:kco_params.update_cart_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){t("body").trigger("update_checkout"),a.kcoResume()}})},updateExtraFields:function(){var e=t(this).attr("name"),o=t(this).val();a.log("value"),a.log(o),a.log("name"),a.log(e),a.log(typeof a.extraFieldsValues),a.log(a.extraFieldsValues),null===a.extraFieldsValues&&""===o||null!==a.extraFieldsValues&&e in a.extraFieldsValues&&o===a.extraFieldsValues||(null===a.extraFieldsValues&&(a.extraFieldsValues={}),a.log("update"),a.extraFieldsValues[e]=o,t.ajax({type:"POST",url:kco_params.update_extra_fields_url,data:{extra_fields_values:a.extraFieldsValues,nonce:kco_params.update_extra_fields_nonce},success:function(e){},error:function(e){},complete:function(e){a.log("complete",e)}}))},updateOrderNotes:function(){a.orderNotesEl.val()!==a.orderNotesValue&&(a.orderNotesValue=a.orderNotesEl.val(),t.ajax({type:"POST",url:kco_params.update_order_notes_url,data:{order_notes:a.orderNotesValue,nonce:kco_params.update_order_notes_nonce},success:function(e){},error:function(e){},complete:function(e){a.log("complete",e)}}))},updateKlarnaOrder:function(){"kco"===a.paymentMethod&&t.ajax({type:"POST",url:kco_params.update_klarna_order_url,data:{nonce:kco_params.update_klarna_order_nonce},dataType:"json",success:function(e){},error:function(e){},complete:function(e){a.kcoResume()}})},changeFromKco:function(e){e.preventDefault(),t(a.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.ajax({type:"POST",dataType:"json",data:{kco:!1,nonce:kco_params.change_payment_method_nonce},url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){a.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})},maybeChangeToKco:function(){a.log(t(this).val()),"kco"===t(this).val()&&(t(".woocommerce-info").remove(),t(a.checkoutFormSelector).block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),t.ajax({type:"POST",data:{kco:!0,nonce:kco_params.change_payment_method_nonce},dataType:"json",url:kco_params.change_payment_method_url,success:function(e){},error:function(e){},complete:function(e){a.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}}))},checkoutError:function(){if("kco"===a.paymentMethod){var e=t(".woocommerce-NoticeGroup-checkout").text();t.ajax({type:"POST",dataType:"json",data:{kco:!1,error_message:e,nonce:kco_params.checkout_error_nonce},url:kco_params.checkout_error_url,success:function(e){},error:function(e){},complete:function(e){a.log(e.responseJSON),window.location.href=e.responseJSON.data.redirect}})}},log:function(e){kco_params.logging&&console.log(e)},init:function(){t(document).ready(a.documentReady),a.bodyEl.on("update_checkout",a.kcoSuspend),a.bodyEl.on("updated_checkout",a.updateKlarnaOrder),a.bodyEl.on("checkout_error",a.checkoutError),a.bodyEl.on("change","input.qty",a.updateCart),a.bodyEl.on("blur",a.extraFieldsSelectorText,a.updateExtraFields),a.bodyEl.on("change",a.extraFieldsSelectorNonText,a.updateExtraFields),a.bodyEl.on("change",'input[name="payment_method"]',a.maybeChangeToKco),a.bodyEl.on("click",a.selectAnotherSelector,a.changeFromKco),"function"==typeof window._klarnaCheckout&&window._klarnaCheckout(function(e){e.on({shipping_address_change:function(e){a.log("shipping_address_change"),a.log(e),t(".woocommerce-checkout-review-order-table").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a.kcoSuspend(),t.ajax({url:kco_params.iframe_shipping_address_change_url,type:"POST",dataType:"json",data:{data:e,nonce:kco_params.iframe_shipping_address_change_nonce},success:function(e){a.log(e),t(".woocommerce-checkout-review-order-table").replaceWith(e.data.html)},error:function(e){a.log(e)},complete:function(){t(".woocommerce-checkout-review-order-table").unblock(),a.kcoResume()}})},change:function(e){a.log("change",e)},order_total_change:function(e){a.log("order_total_change",e)},shipping_option_change:function(e){a.log("shipping_option_change",e)},can_not_complete_order:function(e){a.log("can_not_complete_order",e)}})})}};a.init()});